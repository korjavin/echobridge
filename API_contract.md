# **Interface Specification**

## **1.0 Overview**

This document defines the single, immutable RESTful API contract between the **Telegram Bot Service (Client)** and the **Alexa Skill Backend (Server)**. Strict adherence to this contract is mandatory to ensure successful integration and to facilitate independent, parallel development of the two services.

## **2.0 Authentication**

All requests made to the Alexa Skill Backend endpoint MUST include a custom HTTP header `x-api-key` containing a pre-shared secret value (an API Key generated by Amazon API Gateway). Requests that lack a valid API key will be rejected by the API Gateway with an HTTP 403 Forbidden status code.

## **3.0 Endpoint Specification**

The communication between the two services is handled by a single API endpoint. The design of this endpoint is critical for enabling the two development teams to work in parallel. By establishing a rigid contract, the Telegram developer can build their entire logic against a mocked version of this endpoint, while the Alexa developer knows the exact structure of the data they will receive. This formal contract serves as the ultimate source of truth for inter-service communication.

| Property | Value |
|:---------|:------|
| **Method** | POST |
| **Path** | /v1/message |
| **Authentication** | x-api-key header required |
| **Request Body Format** | application/json |
| **Success Response** | 202 Accepted |
| **Error Responses** | 400 Bad Request, 401 Unauthorized, 403 Forbidden, 500 Server Error |

A 202 Accepted response indicates that the backend has received the request and has initiated processing. It does not guarantee final delivery of the notification or audio, as that process is asynchronous.

## **4.0 Request Body Schema**

The body of the POST request must be a JSON object that conforms to the following schema.

```json
{
  "type": "object",
  "properties": {
    "userAccessToken": {
      "type": "string",
      "description": "The OAuth 2.0 access token for the user, obtained via Cognito during the account linking process. This token is used to identify the target user in the Alexa system."
    },
    "messageType": {
      "type": "string",
      "enum": ["TEXT", "VOICE"],
      "description": "Specifies whether the payload contains a text message or a voice message."
    },
    "payload": {
      "type": "object",
      "properties": {
        "text": {
          "type": "string",
          "description": "The content of the text message. This field is required and must be non-empty if messageType is 'TEXT'."
        },
        "audioUrl": {
          "type": "string",
          "format": "uri",
          "description": "A secure, time-limited, pre-signed S3 URL pointing to the transcoded MP3 audio file. This field is required if messageType is 'VOICE'."
        }
      },
      "description": "The message content."
    }
  },
  "required": ["userAccessToken", "messageType", "payload"]
}
```

## **5.0 Response Schemas**

### **5.1 Success Response (202 Accepted)**

```json
{
  "status": "success",
  "messageId": "a-unique-uuid-for-tracking"
}
```

### **5.2 Error Response (4xx or 5xx)**

```json
{
  "status": "error",
  "message": "A descriptive error message explaining the failure."
}
```